{% extends "ResourceLocator/base.html" %}

{% load static %}

{% load crispy_forms_tags %}

{% block Title %}

<link rel="shortcut icon" href="{% static 'ResourceLocator/static/img/icons/profile.png' %}" />

<title>Profile</title>


{% endblock Title %}

{% block js_script %}

<script>


introJs().setOptions({
  steps: [{
    intro: "Welcome to Resource Locator Tool. Here is the Quick Product Tour"
  }, {
  title: "Resource Locator",
    element: document.querySelector('#profilepage'),
    intro: "Click here to Update Username and Email"
  },
  {
   title: "Resource Locator",
    element: document.querySelector('#userupdatebutton'),
    intro: "Click here to Update FullName and Region. Please fill out the Region field to view the docker's list"
  }
  ]
}).start();




function updateuserdetails()
{

var URL="{% url 'UserUpdate' %}"
document.getElementById("userupdatebutton").innerHTML = "Updating";
document.getElementById("userupdatebutton").disabled = true;
var list =[];
list.push(document.getElementById("FullName").value);
list.push(document.getElementById("Region").value);

var xhr = new XMLHttpRequest();
		
		xhr.open('POST', URL, true);
		xhr.onload = function () {
    // do something to response
    	if(this.responseText == 'success'){
			window.location.reload(true);
		}
		};
		xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
		xhr.send(list);
}


</script>
{% endblock js_script %}

{% block content %}

            <div class="container-fluid p-0">

                <h1 class="h3 mb-3">Profile</h1>

                <div class="row">
                    <div class="col-md-3 col-xl-2">

                        <div class="card">

                            <div class="list-group list-group-flush" role="tablist">
                                <a class="list-group-item list-group-item-action active" data-bs-toggle="list" href="#account" role="tab">
      Account
    </a>
                                <a class="list-group-item list-group-item-action" href="/profilePasswordChange/">
      Password
    </a>
                               
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="account" role="tabpanel">
                                {% if messages %}
									{% for message in messages %}
                                    <div class="alert alert-success alert-dismissible" role="alert">
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                        <div class="alert-message">
                                            {{ message }}
                                        </div>
                                    </div>
									{% endfor %}
								{% endif %}
                                <div class="card">
                                    <div class="card-body m-sm-4">
                                        <form method="POST">
                                            {% csrf_token %}
                                            <div class="mb-3">
                                                {{ form.username | as_crispy_field}}
                                            </div>
                                            <div class="mb-3">
                                                {{ form.email | as_crispy_field}}
                                            </div>

                                        <div class="text-left mt-3">
                                            <button type="submit" class="btn btn-primary" name='accchange' id="Usernameupdate" >Update</button>
                                        </div>
                                        </form>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="account" role="tabpanel">
                                <div class="card">
                                    <div class="card-body m-sm-4">
                                        <form method="POST" onsubmit='updateuserdetails();'>
                                            <div class="mb-3">
                                                <label for="id_username">Full Name</label>
                                            </div>
                                            <div class="mb-3">
                                                <input type="text" id="FullName" value="{{user_object.FullName}}" maxlength="150" class="textinput textInput form-control" required="" id="id_username" placeholder='Feel free to fill your full name'>
                                            </div>
                                            <div class="mb-3">
                                                <label for="id_username">Groups</label>
                                            </div>
                                            <div class="mb-3">
                                            {% for group in user.groups.all %}
                                            <a href='#' class='badge bg-primary me-1 my-1'>{{group}}</a>
                                            {% endfor %}
                                            </div>
                                            <div class="mb-3">
                                                <label for="id_username">Region</label>
                                            </div>
                                            <div class="mb-3">
                                                <input type="text" id="Region" value="{{user_object.region}}" maxlength="150" class="textinput textInput form-control" required="" id="id_username" placeholder='ISC or US or UK'>
                                            </div>
                                            <br>
                                        <div class="mb-3">
                                            <p>{% csrf_token %}<button type="submit" class="btn btn-primary" id="userupdatebutton" > Update </button></p>
                                        </div>
                                        </form>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>


    </div>
</div>

{% endblock content %}